# Angular02 - 專案結構
**此教學文使用 Angular 17.3.2 version**

要使用 Angular 來開發，那就不得不提專案結構了，個人認為 Angular 的專案結構是 Angular 精隨之一，透過專案結構也能讓專案更好維護，以下會大致整理 Angular 的專案架構，以及介紹幾個開發比較常用到的設定，如果想了解更多資訊都可以在搜尋其他相關資料。

[目錄]
- [Angular02 - 專案結構](#angular02---專案結構)
  - [Angular 專案結構](#angular-專案結構)
    - [Angular workspace root level](#angular-workspace-root-level)
    - [Angular workspace project level](#angular-workspace-project-level)
      - [src 結構](#src-結構)
  - [詳細介紹](#詳細介紹)
    - [ Angular.json ](#-angularjson-)
    - [ package.json ](#-packagejson-)
    - [ src/app 資料結構](#-srcapp-資料結構)
  - [參考連結](#參考連結)


## Angular 專案結構

前面有先使用 `Angular CLI` 建立專案，建立完後，會發現指令幫助建立了一個基本的程式架構。可以發現有許多檔案，這個就是 Angular 的專案結構。

**:bulb: tip**
Angular 還支援多個專案的工作區，在此不介紹，可以參考[連結](https://angular.io/guide/file-structure#multiple-projects)。

###  Angular workspace root level 
* **.editorconfig** - 幫助開發人員在不同的編輯器和 IDE 間更容易定義與維護一致的編碼樣式。 查看 [EditorConfig](https://editorconfig.org)。
* **.gitignore** - 在 Git 版本控制內設定忽略的檔案。
* **README\.md**- 專案的介紹文件。
* **[angular.json](#angularJson)** - Angular CLI 的設定檔。
* **[package.json](#packageJson)** - 專案工作區中所有專案可用的 npm 套件相依。
* **package-lock.json** -  提供 npm 客戶端安裝(`npm install`)到 `node_modules` 中所有軟體套件的版本資訊，主要以紀錄當前實際安裝的套件來源及版號。
* **src/** - 主要在開發的所有程式碼放在這。
* **node_modules/** - `npm install` 安裝套件時所產生的文件，通常在 git 中會忽略此資料夾，避免上傳的資料太大。
* **tsconfig.json** - TTypeScript 編譯時使用的設定檔，其他配置檔案都繼承此檔案。 可參考 TypeScript 文件中的[透過 extends 進行配置繼承](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html#configuration-inheritance-with-extends)部分。

**:bulb: 補充**
 * **.browserslist** - 設定瀏覽器相容性，用在不同前端工具之間，設定目標瀏覽器及 Node.js版本 的配置工具，參考 [browserslist 文件](https://github.com/browserslist/browserslist)有更詳細的介紹。
 * **karma.conf.js** - 客製化 Karma 的設定檔。（測試使用）


### Angular workspace project level 
#### src 結構
* [app](#app) - 所有應用程式的 Module、Component、Service 等等都放在這，更詳細的資訊會在下面介紹。
* assets - 建構時需要原樣複製的資源檔，主要是放置圖片、多國語等。
* favicon.ico - 網站圖示。
* index.html - 起始頁面， `CLI` 會在建構你的應用時自動新增所有的 JavaScript 和 CSS 檔案，所以你通常不用手動新增任何 `<script>` 或 `<link>` 標籤。
* main.ts - 應用的主要入口點。 以 [JIT compiler](https://angular.tw/guide/glossary#jit) 進行編譯，也可以使用 [AOT compiler](https://angular.tw/guide/aot-compiler) 編譯。
* styles.scss - 為專案提供樣式的 CSS 檔案。

**:bulb: 補充**
* environments - 環境設定預設有以下兩種，也能新增其他環境。
    - environment.prod.ts - 常用於正式環境。
    - environment.ts  - 常用於開發環境。
* polyfills.ts - Angular 不支援現代瀏覽器的所有特性。你可以透過載入Polyfill指令碼來為想要支援的瀏覽器彌補這些特性。可參考[連結](https://angular.tw/guide/browser-support#polyfills)。
* test.ts - 單元測試的主入口點，帶有一些 Angular 特有的配置，通常不需要編輯這個檔案。
  *Angular 17 可使用 Web Test Runner 來取代 Karma 執行瀏覽器測試，可參考[連結](https://blog.angular-university.io/angular-17-1-release/)。



## 詳細介紹

### <a id="angularJson" > Angular.json </a>

Angular.json 主要是提供工作區與專案的配置設定，供 Angular CLI 中建構及開發工具所使用，在這邊介紹幾個比較常會用到的設定，更詳細的資訊可以參考[官方文件](https://angular.tw/guide/workspace-config)。


在 angular.json 中有一個 `projects:<project_name>` 的有以下之資料

```
"my-app": {
  "root": "",
  "sourceRoot": "src",
  "projectType": "application",
  "prefix": "app",
  "schematics": {},
  "architect": {}
}
```

其中最常使用到的是 `architect` ， `architect` 是 Angular CLI 用來執行複雜任務（如編譯和測試執行），透過 `ng run` 來執行你所設定的建構式。
以下是 `architect` 的結構
```
  "architect": {
    "build": {},
    "serve": {},
    "e2e" : {},
    "test": {},
    "lint": {},
    "extract-i18n": {},
    "server": {},
    "app-shell": {}
  } 
```

那最常使用的是 `build` 在發布中的設定，所以主要介紹此設定。
`architect/build` 是執行 `ng build` 命令時的選項配置預設值，所以建構時需要額外的設定可以透過以下配置檔案設定，也能直接使用 `ng config` 命令。

`architect/build` 主要包含以下屬性:
- builder - 用於建構此目標的建構工具的 npm 套件。預設為 `@angular-devkit/build-angular:browser`，它使用的是 webpack 打包器。
- options - 建構時的預設值
    - build
        - outputPath - 輸出的路徑，常為專案底下的 `dict/<project_name>`
        - index - 起始頁面
        - main - 應用的主要入口
        - polyfills - polyfills 設定
        - tsConfig - tsConfig 設定
        - aot - compiler 模式為 aot
        - assets - 建立專案時要複製的檔案或資料夾，主要為專案使用的靜態檔案路徑，預設為圖示檔案及 asset 資料夾
          ```
          "assets": [
            "src/assets",
            "src/favicon.ico"
          ]
          ```
        - styles - 專案所使用的樣式檔案，例如 `bootstrap` 的樣式檔案
          ```
          "styles": [
            "src/styles.css",
            "src/more-styles.css",
            { "input": "src/lazy-style.scss", "inject": false },
            { "input": "src/pre-rename-style.scss", "bundleName": "renamed-style" },
          ]
          ```
        - scripts - 專案所使用的 JavaScript 指令檔，例如 `chart.js`
          ```
          "scripts": [
            "node_modules/chartjs/chart.js"
          ]
          ```
        
    - configurations - 可行依專案所使用的開發環境新增設定
        - {environment} (可自行命名環境)
            - fileReplacements - 設定需要取代的檔案，常用於取代 environment
        ```
        "configurations": {
          "production": {
            "fileReplacements": [
              {
                "replace": "src/environments/environment.ts",
                "with": "src/environments/environment.prod.ts"
              }
            ],
            "optimization": true,
            "outputHashing": "all",
            "sourceMap": false,
            "extractCss": true,
            "namedChunks": false,
            "aot": true,
            "extractLicenses": true,
            "vendorChunk": false,
            "buildOptimizer": true
          },
        ```



### <a id="packageJson"> package.json </a>
僅簡單說明常用的 package.json 設定，
更詳細的請參考: [Specifics of npm's package.json handling](https://ithelp.ithome.com.tw/articles/10195369?sc=iThelpR)

- scripts - 支援多種預設的scripts 指令來快速執行命令，透過 `npm run <stage>` 或 `npm run-script <stage>` 來執行，請參考以下範例: 
    ```
      "scripts": {
        "ng": "ng",
        //設定特定的port
        "start": "ng serve --port {portnumber}", 
        //設定 build 時使用的 config 及設置伺服器上預設的路徑 
        "build": "ng build --configuration dev --base-href /my-frist-angular/",
        "test": "ng test",
        "lint": "ng lint",
        "e2e": "ng e2e"
      },
    ```
- dependencies: 要運行這個應用必要一定要安裝的 package。
- devDependencies: 只有在開發時需要用到的功能，當別人要導入我們所開發的專案時，不一定要下載完整的 devDependencies 內容。

### <a id="app" /> src/app 資料結構</a>
- app.component.ts	- 預設應用的起始元件(Component)，主要在定義邏輯。
- app.component.html - 預設應用的起始 HTML 範本。
- app.component.css	- 預設應用的起始的基本 CSS 樣式表。
- app.component.spec.ts	- 為起始元件 AppComponent 定義的單元測試。
- app.module.ts	- AppModule 為預設的根模組，它會告訴 Angular 如何組裝應用。如果要在應用中新增其他元件，也必須同時在這裡宣告。

> 若為大型專案可以參考以下結構:
> - Common - 放置共用且不會由路由開啟的 Component
> - Service - 放置 Service
> - Pipe - 放置 pipe
> - Definitions - 放置資料結構
> - feature (特定功能的名稱)
> \- components - 放置此功能需使用到的 component
> \- feature-routing.module.ts - 定義此feature 的 router
> \- feature.module.ts - 放入此功能需要的component，以方便區分不同的module

## 參考連結
[Angular File-Structure 官方介紹](https://angular.tw/guide/file-structure)
[Angular 工作區配置 官方介紹](https://angular.tw/guide/workspace-config)
[Browserslist](https://github.com/browserslist/browserslist)
[Specifics of npm's package.json handling](https://ithelp.ithome.com.tw/articles/10195369?sc=iThelpR)
[設定 Angular 專案使用 ESLint 進行更嚴格的程式碼撰寫風格檢查](https://blog.miniasp.com/post/2021/08/29/Angular-ESLint-with-so-much-details)
[JIT compiler](https://angular.tw/guide/glossary#jit)
[AOT compiler](https://angular.tw/guide/aot-compiler) 